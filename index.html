<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اليرموك للخياطة - المتجر المتكامل</title>
    <style>
        :root { --gold: #d4af37; --brown: #5d4037; --bg: #fdfbf7; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); margin: 0; padding: 10px; direction: rtl; }
        
        .main-container { max-width: 600px; margin: auto; background: var(--white); border-radius: 20px; border: 1px solid var(--gold); box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* الهيدر وبيانات العميل */
        .header { text-align: center; padding: 20px; border-bottom: 2px solid var(--gold); }
        .logo { width: 150px; margin-bottom: 10px; }
        .cust-info { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; background: #fff9eb; }
        .cust-info input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; outline: none; }

        /* التبويبات الرئيسية */
        .main-tabs { display: flex; background: #eee; }
        .tab-btn { flex: 1; padding: 15px; border: none; cursor: pointer; font-weight: bold; background: #eee; color: #666; transition: 0.3s; }
        .tab-btn.active { background: var(--gold); color: white; }

        .section { display: none; padding: 15px; }
        .section.active { display: block; }

        /* قسم التفصيل */
        .tailor-card { border: 2px solid #eee; border-radius: 15px; padding: 15px; margin-bottom: 20px; position: relative; background: #fff; }
        .remove-card { position: absolute; top: 10px; left: 10px; background: #ff4d4d; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; }
        
        .fabric-display { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin: 15px 0; }
        .fab-item { border: 1px solid #ddd; border-radius: 10px; overflow: hidden; cursor: pointer; text-align: center; background: #fff; }
        .fab-item.selected { border: 3px solid var(--gold); box-shadow: 0 0 10px rgba(212,175,55,0.5); }
        .fab-item img { width: 100%; height: 100px; object-fit: cover; }
        .fab-info { padding: 5px; font-size: 12px; }

        .measure-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 15px 0; }
        .measure-grid div { text-align: center; }
        .measure-grid label { font-size: 11px; color: #777; font-weight: bold; }
        .measure-grid input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; text-align: center; box-sizing: border-box; }

        /* قسم الجاهز */
        .ready-nav { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .ready-type-btn { padding: 10px 15px; border: 1px solid var(--gold); border-radius: 20px; background: white; white-space: nowrap; cursor: pointer; font-size: 13px; }
        .ready-type-btn.active { background: var(--brown); color: white; }
        
        .items-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .product-card { border: 1px solid #eee; border-radius: 15px; overflow: hidden; background: white; }
        .product-card img { width: 100%; height: 180px; object-fit: cover; }
        .product-details { padding: 10px; text-align: center; }
        .price-tag { color: var(--green); font-weight: bold; font-size: 16px; }
        .old-price { text-decoration: line-through; color: #999; font-size: 12px; margin-left: 5px; }

        /* لوحة التحكم */
        .admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center; }
        .admin-content { background: #222; color: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; border: 1px solid var(--gold); }
        .admin-content input, .admin-content select { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none; box-sizing: border-box; }
        
        /* أزرار الإجراءات */
        .btn-add-more { width: 100%; padding: 12px; background: #fff; color: var(--gold); border: 2px dashed var(--gold); border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-send { width: 100%; padding: 18px; background: var(--brown); color: white; border: none; border-radius: 15px; font-size: 18px; font-weight: bold; margin-top: 20px; cursor: pointer; }
        .settings-btn { position: fixed; bottom: 20px; left: 20px; background: var(--white); border: 1px solid var(--gold); border-radius: 50%; width: 50px; height: 50px; cursor: pointer; font-size: 24px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 1000; }
    </style>
</head>
<body>

<button class="settings-btn" onclick="openAdmin()">⚙️</button>

<div class="main-container">
    <div class="header">
        <img src="https://i.imgur.com/eBfP6XG.png" class="logo" alt="اليرموك">
        <h2 style="margin:0; color:var(--brown)">اليرموك للخياطة الرجالية</h2>
    </div>

    <div class="cust-info">
        <input type="text" id="c_name" placeholder="إسم العميل الكامل">
        <input type="tel" id="c_phone" placeholder="رقم الهاتف (7xxxxxxxx)">
    </div>

    <div class="main-tabs">
        <button class="tab-btn active" onclick="switchMainTab('tailor')">التفصيل والأقمشة</button>
        <button class="tab-btn" onclick="switchMainTab('ready')">الملابس الجاهزة</button>
    </div>

    <form id="masterForm">
        <div id="section_tailor" class="section active">
            <div id="tailor_list">
                </div>
            <button type="button" class="btn-add-more" onclick="addNewTailor()">+ إضافة ثوب تفصيل آخر</button>
        </div>

        <div id="section_ready" class="section">
            <div class="ready-nav">
                <button type="button" class="ready-type-btn active" onclick="filterReady('all', this)">الكل</button>
                <button type="button" class="ready-type-btn" onclick="filterReady('thobe', this)">ثياب جاهزة</button>
                <button type="button" class="ready-type-btn" onclick="filterReady('coat', this)">أكوات جاهزة</button>
                <button type="button" class="ready-type-btn" onclick="filterReady('shawl', this)">شيلان</button>
            </div>
            <div id="ready_items_display" class="items-grid">
                </div>
        </div>

        <div style="background: var(--brown); color:white; padding:20px; text-align:center; margin-top:20px;">
            <div style="font-size:14px; opacity:0.8;">الإجمالي المستحق</div>
            <div style="font-size:28px; font-weight:bold;"><span id="final_total">0</span> ريال</div>
        </div>

        <button type="button" class="btn-send" onclick="submitOrder()">تأكيد الطلب وإرسال عبر واتساب</button>
    </form>
</div>

<div id="adminPanel" class="admin-panel">
    <div class="admin-content">
        <h3 style="text-align:center; margin-top:0; color:var(--gold);">إدارة اليرموك</h3>
        <select id="adm_cat">
            <option value="fabric">قماش جديد (لقسم التفصيل)</option>
            <option value="thobe">ثوب جاهز</option>
            <option value="coat">كوت جاهز</option>
            <option value="shawl">شال جاهز</option>
        </select>
        <input type="file" id="adm_file" onchange="encodeImg(this)">
        <input type="text" id="adm_title" placeholder="اسم المنتج/القماش">
        <input type="text" id="adm_desc" placeholder="وصف موجز">
        <input type="number" id="adm_old" placeholder="السعر السابق (ريال)">
        <input type="number" id="adm_new" placeholder="السعر الحالي (ريال)">
        
        <button onclick="saveProduct()" style="width:100%; padding:12px; background:var(--gold); border:none; color:white; font-weight:bold; border-radius:8px; cursor:pointer;">تحديث المتجر للعملاء</button>
        <button onclick="closeAdmin()" style="width:100%; background:none; border:none; color:white; margin-top:10px; cursor:pointer;">إغلاق</button>
    </div>
</div>

<script>
    let db = { fabrics: [], ready: [] };
    let tempImg = "";

    function openAdmin() { if(prompt("كلمة مرور الإدارة:") === "1234") document.getElementById('adminPanel').style.display='flex'; }
    function closeAdmin() { document.getElementById('adminPanel').style.display='none'; }
    function encodeImg(i) { let r = new FileReader(); r.onload = (e) => tempImg = e.target.result; r.readAsDataURL(i.files[0]); }

    function switchMainTab(t) {
        document.querySelectorAll('.section, .tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('section_'+t).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function saveProduct() {
        const cat = document.getElementById('adm_cat').value;
        const item = {
            id: Date.now(),
            cat: cat,
            img: tempImg,
            title: document.getElementById('adm_title').value,
            desc: document.getElementById('adm_desc').value,
            oldPrice: document.getElementById('adm_old').value,
            newPrice: document.getElementById('adm_new').value
        };

        if(cat === 'fabric') db.fabrics.push(item);
        else db.ready.push(item);

        alert("تمت الإضافة بنجاح!");
        renderAll();
        closeAdmin();
    }

    function renderAll() {
        // تحديث قسم الجاهز
        filterReady('all');
        // تحديث اختيار الأقمشة في قوالب التفصيل
        document.querySelectorAll('.fabric-display').forEach(div => {
            const blockId = div.id.split('_')[1];
            div.innerHTML = db.fabrics.map(f => `
                <div class="fab-item" onclick="selectFab(${blockId}, ${f.newPrice}, '${f.title}', this)">
                    <img src="${f.img}">
                    <div class="fab-info"><b>${f.title}</b><br><span style="color:green">${f.newPrice} ريال</span></div>
                </div>
            `).join('');
        });
    }

    function filterReady(type, btn) {
        if(btn) {
            document.querySelectorAll('.ready-type-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        const display = document.getElementById('ready_items_display');
        const items = type === 'all' ? db.ready : db.ready.filter(i => i.cat === type);
        
        display.innerHTML = items.map(i => `
            <div class="product-card">
                <img src="${i.img}">
                <div class="product-details">
                    <div style="font-weight:bold; font-size:14px;">${i.title}</div>
                    <div style="font-size:11px; color:#666; margin-bottom:5px;">${i.desc}</div>
                    <div><span class="old-price">${i.oldPrice}</span><span class="price-tag">${i.newPrice} ريال</span></div>
                    <button type="button" onclick="addToTotal(${i.newPrice})" style="width:100%; margin-top:8px; border:1px solid var(--gold); background:none; border-radius:5px; font-size:12px; cursor:pointer;">إضافة للطلب</button>
                </div>
            </div>
        `).join('');
    }

    let readyTotal = 0;
    function addToTotal(p) { readyTotal += parseInt(p); calcGrandTotal(); alert("تمت إضافة المنتج الجاهز للإجمالي"); }

    function addNewTailor() {
        const id = Date.now();
        const block = document.createElement('div');
        block.className = 'tailor-card';
        block.id = `block_${id}`;
        block.innerHTML = `
            <button type="button" class="remove-card" onclick="document.getElementById('block_${id}').remove(); calcGrandTotal();">×</button>
            <h4 style="margin:0 0 15px 0; color:var(--brown)">تفصيل ثوب جديد</h4>
            <label style="font-size:13px; font-weight:bold;">1. اختر القماش من المعرض:</label>
            <div class="fabric-display" id="fabDisplay_${id}">
                ${db.fabrics.length ? '' : '<p style="font-size:11px; color:red;">يرجى رفع الأقمشة من الإدارة أولاً</p>'}
            </div>
            <label style="font-size:13px; font-weight:bold;">2. المقاسات (بالهنش):</label>
            <div class="measure-grid">
                <div><label>الطول</label><input type="number" step="0.1"></div>
                <div><label>الكتف</label><input type="number" step="0.1"></div>
                <div><label>طول اليد</label><input type="number" step="0.1"></div>
                <div><label>وسع الصدر</label><input type="number" step="0.1"></div>
                <div><label>الرقبة</label><input type="number" step="0.1"></div>
                <div><label>وسط اليد</label><input type="number" step="0.1"></div>
                <div><label>طول الكبك</label><input type="number" step="0.1"></div>
                <div><label>وسع الخطوة</label><input type="number" step="0.1"></div>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                <select><option>قلاب ملكي</option><option>قلاب فرنسي</option><option>قلاب دائري</option><option>صيني</option></select>
                <select><option>كبك قماش</option><option>كبك حشو</option><option>سادة</option></select>
            </div>
            <input type="hidden" class="item-price" value="0">
        `;
        document.getElementById('tailor_list').appendChild(block);
        renderAll();
    }

    function selectFab(bid, p, name, el) {
        const div = document.getElementById(`fabDisplay_${bid}`);
        div.querySelectorAll('.fab-item').forEach(i => i.classList.remove('selected'));
        el.classList.add('selected');
        document.querySelector(`#block_${bid} .item-price`).value = p;
        calcGrandTotal();
    }

    function calcGrandTotal() {
        let t = readyTotal;
        document.querySelectorAll('.item-price').forEach(i => t += parseInt(i.value));
        document.getElementById('final_total').innerText = t.toLocaleString();
    }

    function submitOrder() {
        const name = document.getElementById('c_name').value;
        if(!name) return alert("يرجى كتابة إسم العميل");
        let msg = `طلب جديد من: ${name}%0Aالإجمالي: ${document.getElementById('final_total').innerText} ريال`;
        window.open(`https://wa.me/967773463560?text=${msg}`);
    }

    window.onload = addNewTailor;
</script>

</body>
</html>
