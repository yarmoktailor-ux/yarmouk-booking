<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø­Ø¯ÙŠØ« - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø·Ù„Ø¨</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --gold: #d4af37; --brown: #5d4037; --bg: #fdfbf7; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); margin: 0; padding: 0; direction: rtl; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { text-align: center; padding: 20px; background: #fff; border-bottom: 3px solid var(--gold); position: relative; }
        #main_logo { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 2px solid var(--gold); }
        .admin-trigger { position: absolute; top: 10px; left: 10px; background: var(--brown); color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; font-size: 12px; }

        .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 20px; }
        
        /* Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .section-title { color: var(--brown); border-right: 4px solid var(--gold); padding-right: 10px; margin: 20px 0 10px; }
        .cust-data input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }

        /* Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª */
        .measure-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .measure-grid input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; text-align: center; }
        .measure-grid label { font-size: 11px; display: block; text-align: center; color: var(--brown); font-weight: bold; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
        .add-btn-large { width: 100%; padding: 18px; background: var(--white); border: 2px dashed var(--gold); color: var(--gold); border-radius: 15px; font-weight: bold; cursor: pointer; font-size: 16px; margin: 10px 0; transition: 0.3s; }
        .add-btn-large:hover { background: #fff9eb; }
        
        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø§Ù„Ù…Ø®ÙÙŠ) */
        .product-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:5000; overflow-y:auto; padding:20px; box-sizing:border-box; }
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .item-card { background: white; border-radius: 12px; overflow: hidden; text-align: center; padding-bottom: 10px; }
        .item-card img { width: 100%; height: 160px; object-fit: cover; }
        .price-tag { margin: 5px 0; }
        .price-old { text-decoration: line-through; color: red; font-size: 12px; margin-left: 5px; }
        .price-new { color: green; font-weight: bold; font-size: 15px; }

        /* Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„ØªÙØµÙŠÙ„ */
        .cart-item { background: #fdfaf0; border: 1px solid var(--gold); border-radius: 15px; padding: 15px; margin-bottom: 10px; }
        .tailor-opts select { width: 100%; padding: 8px; margin-top: 5px; border-radius: 8px; border: 1px solid #ccc; font-size: 12px; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
        #adminPanel { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:10000; overflow-y:auto; padding: 20px; box-sizing: border-box; }
        .admin-form { background: #f4f4f4; padding: 15px; border-radius: 15px; margin-bottom: 20px; }
        .admin-form input, .admin-form select, .admin-form textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 8px; }

        #final_box { margin-top:30px; text-align:center; background:var(--brown); color:white; padding:20px; border-radius:15px; }
    </style>
</head>
<body>

<div class="header">
    <button class="admin-trigger" onclick="checkAdmin()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    <img src="" id="main_logo" alt="Ø§Ù„Ø´Ø¹Ø§Ø±">
    <h2 id="store_name">Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø­Ø¯ÙŠØ« Ù„Ø®ÙŠØ§Ø·Ø© Ø§Ù„Ø«ÙŠØ§Ø¨</h2>
</div>

<div class="container">
    <h4 class="section-title">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
    <div class="cust-data">
        <input type="text" id="c_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ">
        <input type="tel" id="c_phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    </div>

    <h4 class="section-title">ğŸ“ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</h4>
    <div class="measure-grid">
        <div><label>Ø·ÙˆÙ„</label><input type="number" id="m1"></div>
        <div><label>ÙƒØªÙ</label><input type="number" id="m2"></div>
        <div><label>ÙŠØ¯</label><input type="number" id="m3"></div>
        <div><label>ØµØ¯Ø±</label><input type="number" id="m4"></div>
        <div><label>Ø±Ù‚Ø¨Ø©</label><input type="number" id="m5"></div>
        <div><label>ÙˆØ³Ø·</label><input type="number" id="m6"></div>
        <div><label>ÙƒØ¨Ùƒ</label><input type="number" id="m7"></div>
        <div><label>Ø®Ø·ÙˆØ©</label><input type="number" id="m8"></div>
    </div>

    <h4 class="section-title">ğŸ“¦ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
    <button class="add-btn-large" onclick="openProducts('fabric')">â• Ø¥Ø¶Ø§ÙØ© Ù‚Ù…Ø§Ø´ Ø¬Ø¯ÙŠØ¯</button>
    <button class="add-btn-large" onclick="openProducts('ready')">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø§Ù‡Ø²Ø© (Ø£ÙƒÙˆØ§Ø¯/Ø´ÙŠÙ„Ø§Ù†)</button>

    <div id="cart_area"></div>

    <div id="final_box">
        <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total_price">0</span> Ø±ÙŠØ§Ù„</h3>
        <button onclick="submitOrder()" style="width:100%; padding:15px; background:var(--gold); color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>
</div>

<div id="productModal" class="product-modal">
    <div style="display:flex; justify-content:space-between; color:white; margin-bottom:20px;">
        <h3>Ø§Ù„Ù…Ø¹Ø±Ø¶</h3>
        <button onclick="closeProducts()" style="background:red; color:white; border:none; padding:10px; border-radius:5px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚ X</button>
    </div>
    <div id="product_list" class="product-grid"></div>
</div>

<div id="adminPanel">
    <h2 style="text-align:center;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h2>
    <div class="admin-form">
        <h4>ğŸ–¼ï¸ Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„</h4>
        <input type="file" onchange="uploadLogo(this)">
    </div>
    <div class="admin-form">
        <h4>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h4>
        <select id="adm_cat">
            <option value="fabric">Ø£Ù‚Ù…Ø´Ø©</option>
            <option value="ready">Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø§Ù‡Ø²Ø©</option>
        </select>
        <input type="file" onchange="encodeImg(this)">
        <input type="text" id="adm_name" placeholder="Ø§Ù„Ø§Ø³Ù…">
        <textarea id="adm_desc" placeholder="ÙˆØµÙ Ø§Ù„Ù‚Ù…Ø§Ø´/Ø§Ù„Ù…Ù†ØªØ¬"></textarea>
        <input type="number" id="adm_old" placeholder="Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„">
        <input type="number" id="adm_new" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯">
        <button onclick="saveProduct()" style="width:100%; background:green; color:white; padding:10px; border:none; border-radius:5px;">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶</button>
    </div>
    <div id="admin_items_list"></div>
    <button onclick="closeAdmin()" style="width:100%; padding:15px; background:#666; color:white; border:none; border-radius:10px;">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
// --- ØªÙƒÙˆÙŠÙ† Firebase ---
const firebaseConfig = { databaseURL: "https://alyarmok-store-default-rtdb.firebaseio.com/" };
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let allProducts = [];
let cart = [];
let tempImg = "";

// Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
database.ref('settings/logo').on('value', s => { document.getElementById('main_logo').src = s.val() || ''; });
database.ref('products').on('value', s => {
    allProducts = [];
    const data = s.val();
    if(data) for(let id in data) allProducts.push({...data[id], id});
    renderAdminList();
});

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
function checkAdmin() { if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:") === "1234") document.getElementById('adminPanel').style.display='block'; }
function closeAdmin() { document.getElementById('adminPanel').style.display='none'; }
function uploadLogo(i) {
    const reader = new FileReader();
    reader.onload = (e) => database.ref('settings/logo').set(e.target.result);
    reader.readAsDataURL(i.files[0]);
}
function encodeImg(i) {
    const reader = new FileReader();
    reader.onload = (e) => tempImg = e.target.result;
    reader.readAsDataURL(i.files[0]);
}
function saveProduct() {
    const name = document.getElementById('adm_name').value;
    const cat = document.getElementById('adm_cat').value;
    const desc = document.getElementById('adm_desc').value;
    const oldP = document.getElementById('adm_old').value;
    const newP = document.getElementById('adm_new').value;
    if(!tempImg || !name || !newP) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©");
    database.ref('products').push({ name, cat, desc, oldP, newP, img: tempImg })
    .then(() => { alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); tempImg=""; });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø¯Ø§Ø®Ù„ Ø§Ù„Ø²Ø±)
function openProducts(cat) {
    const list = document.getElementById('product_list');
    const filtered = allProducts.filter(p => p.cat === cat);
    list.innerHTML = filtered.map(p => `
        <div class="item-card">
            <img src="${p.img}">
            <div style="padding:10px;">
                <b>${p.name}</b>
                <p style="font-size:11px; color:#666;">${p.desc}</p>
                <div class="price-tag">
                    <span class="price-old">${p.oldP}</span>
                    <span class="price-new">${p.newP} Ø±ÙŠØ§Ù„</span>
                </div>
                <button onclick="addToCart('${p.id}')" style="width:100%; background:var(--gold); color:white; border:none; padding:8px; border-radius:5px; cursor:pointer;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
            </div>
        </div>
    `).join('');
    document.getElementById('productModal').style.display = 'block';
}

function closeProducts() { document.getElementById('productModal').style.display = 'none'; }

function addToCart(id) {
    const p = allProducts.find(x => x.id === id);
    cart.push({...p});
    renderCart();
    closeProducts();
}

function renderCart() {
    const area = document.getElementById('cart_area');
    area.innerHTML = cart.map((p, idx) => `
        <div class="cart-item">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <img src="${p.img}" style="width:40px; height:40px; border-radius:5px;">
                    <b>${p.name} - ${p.newP} Ø±ÙŠØ§Ù„</b>
                </div>
                <button onclick="cart.splice(${idx},1); renderCart();" style="color:red; background:none; border:none; font-weight:bold;">Ø­Ø°Ù</button>
            </div>
            ${p.cat === 'fabric' ? `
            <div class="tailor-opts">
                <select><option>Ø§Ù„Ø®ÙŠØ§Ø·Ø©: Ø³Ø¹ÙˆØ¯ÙŠ</option><option>Ù‚Ø·Ø±ÙŠ</option><option>ÙƒÙˆÙŠØªÙŠ</option><option>Ø¹Ù…Ø§Ù†ÙŠ</option></select>
                <select><option>Ø§Ù„Ø±Ù‚Ø¨Ø©: Ù‚Ù„Ø§Ø¨ Ù…Ù„ÙƒÙŠ</option><option>Ù‚Ù„Ø§Ø¨ ÙØ±Ù†Ø³ÙŠ</option><option>ØµÙŠÙ†ÙŠ</option></select>
                <select><option>Ø§Ù„ÙƒØ¨Ùƒ: Ù‚Ù…Ø§Ø´</option><option>Ø­Ø´Ùˆ</option><option>Ø³Ø§Ø¯Ø©</option></select>
                <select><option>Ø§Ù„Ø¬Ø¨Ø³ÙˆØ±: Ø²Ø±Ø§Ø± Ù…Ø®ÙÙŠ</option><option>ÙƒØ¨Ø³ Ø¸Ø§Ù‡Ø±</option><option>Ø³Ø­Ø§Ø¨</option><option>VIP</option></select>
            </div>` : ''}
        </div>
    `).join('');
    document.getElementById('total_price').innerText = cart.reduce((s, i) => s + parseInt(i.newP), 0);
}

function submitOrder() {
    const name = document.getElementById('c_name').value;
    if(!name || cart.length === 0) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø­Ø¯ÙŠØ«*%0AğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}%0AğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById('total_price').innerText} Ø±ÙŠØ§Ù„%0A%0AğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù: %0A`;
    cart.forEach(i => msg += `- ${i.name}%0A`);
    window.open(`https://wa.me/9677XXXXXXXX?text=${msg}`);
}

function renderAdminList() {
    const list = document.getElementById('admin_items_list');
    list.innerHTML = allProducts.map(p => `
        <div style="background:#eee; padding:8px; margin-bottom:5px; display:flex; justify-content:space-between;">
            <span>${p.name}</span>
            <button onclick="database.ref('products/${p.id}').remove()" style="color:red;">Ø­Ø°Ù</button>
        </div>
    `).join('');
}
</script>
</body>
</html>
