<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خياطة اليرموك - المتجر الذكي</title>
    <style>
        :root { --gold: #d4af37; --brown: #5d4037; --bg: #fdfbf7; --green: #28a745; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); direction: rtl; margin: 0; padding: 15px; }
        .container { background: white; max-width: 800px; margin: auto; padding: 20px; border-radius: 25px; border: 1px solid var(--gold); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* الهيدر والشعار */
        .header { text-align: center; margin-bottom: 20px; }
        .logo { width: 120px; cursor: pointer; }

        /* التنقل */
        .nav-icons { display: flex; justify-content: space-around; margin-bottom: 20px; background: #fff; padding: 10px; border-radius: 15px; border: 1px solid #eee; }
        .nav-item { text-align: center; cursor: pointer; padding: 10px; border-radius: 12px; flex: 1; transition: 0.3s; opacity: 0.5; }
        .nav-item.active { opacity: 1; background: #fff9eb; border: 1px solid var(--gold); }
        .nav-item img { width: 35px; height: 35px; display: block; margin: auto; }
        .nav-item div { font-size: 12px; font-weight: bold; margin-top: 5px; color: var(--brown); }

        .section { display: none; animation: fadeIn 0.4s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* كروت المنتجات الجاهزة */
        .product-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .ready-card { border: 1px solid #eee; border-radius: 15px; overflow: hidden; background: #fff; position: relative; }
        .ready-card img { width: 100%; height: 220px; object-fit: cover; }
        .ready-info { padding: 15px; }
        .ready-price { color: var(--gold); font-weight: bold; font-size: 18px; display: block; margin-bottom: 10px; }
        
        /* التحكم في الكمية */
        .qty-box { display: flex; align-items: center; justify-content: space-between; background: #f9f9f9; padding: 8px; border-radius: 10px; }
        .qty-btn { background: var(--green); color: white; border: none; width: 30px; height: 30px; border-radius: 5px; cursor: pointer; font-size: 20px; }

        /* كرت التفصيل والمقاسات */
        .tailor-card { background: #fff; border: 2px solid #e9e9e9; border-top: 5px solid var(--brown); padding: 15px; border-radius: 15px; margin-bottom: 20px; }
        .grid-measure { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        .grid-measure input { padding: 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 5px; text-align: center; }

        /* لوحة التحكم السرية */
        #adminPanel { display: none; background: #333; color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        .admin-btn { position: fixed; bottom: 20px; left: 20px; background: rgba(0,0,0,0.2); border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; z-index: 1000; }

        .btn-main { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-gold { background: var(--gold); color: white; font-size: 18px; }
        .btn-brown { background: var(--brown); color: white; }

        input, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
    </style>
</head>
<body>

<button class="admin-btn" onclick="checkAdmin()">⚙️</button>

<div class="container">
    <div class="header">
        <img src="https://i.imgur.com/eBfP6XG.png" class="logo" alt="شعار اليرموك">
        <p style="font-size: 12px; color: #888;">773463560 | 776090624</p>
    </div>

    <div id="adminPanel">
        <h4>لوحة تحديث الصور والمنتجات</h4>
        <select id="upCat"><option value="thobe">ثياب جاهزة</option><option value="shawl">شيلان</option><option value="coat">أكوات</option></select>
        <input type="file" id="upImg" accept="image/*" onchange="handleImg(this)" style="margin:10px 0;">
        <input type="text" id="upName" placeholder="اسم المنتج">
        <input type="number" id="upPrice" placeholder="السعر">
        <button class="btn-main" style="background:var(--green); color:white" onclick="uploadData()">تحديث الموقع للجميع</button>
    </div>

    <div class="nav-icons">
        <div class="nav-item active" onclick="openTab('tailor_sec')"><img src="https://i.imgur.com/eBfP6XG.png"><div>التفصيل</div></div>
        <div class="nav-item" onclick="openTab('ready_sec')"><img src="https://i.imgur.com/eBfP6XG.png"><div>الجاهز</div></div>
        <div class="nav-item" onclick="openTab('help_sec')"><img src="https://i.imgur.com/eBfP6XG.png"><div>استفسار</div></div>
    </div>

    <div id="tailor_sec" class="section active">
        <div id="tailor_list"></div>
        <button type="button" class="btn-main btn-brown" onclick="addTailor()">+ إضافة ثوب تفصيل ومقاسات</button>
        <div style="text-align:center; padding:15px; font-weight:bold;">إجمالي التفصيل: <span id="t_total">0</span> ريال</div>
    </div>

    <div id="ready_sec" class="section">
        <div class="product-grid" id="ready_display">
            </div>
        <div style="text-align:center; padding:15px; font-weight:bold; background:#fff9eb; margin-top:10px;">إجمالي الجاهز: <span id="r_total">0</span> ريال</div>
    </div>

    <div id="help_sec" class="section">
        <h3 style="text-align:center">الحجز والاستفسار المباشر</h3>
        <a href="https://wa.me/967773463560?text=استفسار من عميل" class="btn-main btn-brown" style="text-align:center; text-decoration:none; display:block; background:#25D366">واتساب 773463560</a>
        <a href="https://wa.me/967776090624?text=استفسار من عميل" class="btn-main btn-brown" style="text-align:center; text-decoration:none; display:block; background:#128C7E">واتساب 776090624</a>
    </div>

    <div style="margin-top:30px; border-top:2px solid #eee; padding-top:20px;">
        <p style="font-size:13px;"><b>الدفع:</b> الكريمي 3005374854 | جيب 80617</p>
        <input type="file" placeholder="صورة الإيصال" style="background:#f0f0f0; margin-bottom:10px;">
        <div style="background:var(--brown); color:white; padding:15px; border-radius:15px; text-align:center; font-size:22px;">
            الإجمالي: <span id="grand_total">0</span> ريال
        </div>
        <button class="btn-main btn-gold" onclick="sendOrder()">تأكيد وإرسال الطلب (صامت)</button>
    </div>
</div>

<script>
    const n8n_url = 'https://ali991278.app.n8n.cloud/webhook/e4bcc169-93c0-42c5-8226-528f3c6a72e3';
    let base64 = "";
    let cart = {};

    function checkAdmin() {
        if(prompt("رمز الإدارة:") === "1234") document.getElementById('adminPanel').style.display = 'block';
    }

    function handleImg(input) {
        let reader = new FileReader();
        reader.onload = (e) => base64 = e.target.result;
        reader.readAsDataURL(input.files[0]);
    }

    async function uploadData() {
        let data = { type: "update_store", cat: id('upCat').value, name: id('upName').value, price: id('upPrice').value, img: base64 };
        await fetch(n8n_url, { method: 'POST', body: JSON.stringify(data) });
        alert("تم تحديث المتجر بنجاح!");
        location.reload();
    }

    function openTab(t) {
        document.querySelectorAll('.section, .nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function addTailor() {
        let div = document.createElement('div');
        div.className = 'tailor-card';
        div.innerHTML = `
            <h4 style="margin:0">ثوب تفصيل</h4>
            <select class="tp" onchange="calc()"><option value="0">نوع القماش</option><option value="20000">ياباني (20,000)</option><option value="25000">ياباني تتركس (25,000)</option></select>
            <div class="grid-measure">
                <input type="number" placeholder="طول" class="m"><input type="number" placeholder="كتف" class="m"><input type="number" placeholder="يد" class="m">
                <input type="number" placeholder="صدر" class="m"><input type="number" placeholder="رقبة" class="m"><input type="number" placeholder="خطوة" class="m">
                <input type="number" placeholder="وسط" class="m"><input type="number" placeholder="كبك" class="m">
            </div>
            <button onclick="this.parentElement.remove(); calc()" style="color:red; background:none; border:none; margin-top:5px; cursor:pointer;">حذف</button>
        `;
        document.getElementById('tailor_list').appendChild(div);
        calc();
    }

    function calc() {
        let tt = 0; document.querySelectorAll('.tp').forEach(s => tt += parseInt(s.value));
        document.getElementById('t_total').innerText = tt.toLocaleString();
        document.getElementById('grand_total').innerText = tt.toLocaleString(); // تبسيط للبروفة
    }

    async function sendOrder() {
        let order = { name: id('cust_name').value, total: id('grand_total').innerText };
        await fetch(n8n_url, { method: 'POST', body: JSON.stringify(order) });
        alert("تم استلام طلبك، شكراً لك!");
    }

    function id(i) { return document.getElementById(i); }
    window.onload = addTailor;
</script>
</body>
</html>
