<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ù„Ù„Ø®ÙŠØ§Ø·Ø© - Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ 2026</title>
    <style>
        /* ... Ù†ÙØ³ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ... */
    </style>
    <!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ³ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script>
        // Ø¹Ø¯Ù„ firebaseConfig Ø¨Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ù…Ø´Ø±ÙˆØ¹Ùƒ ÙÙŠ Firebase
        const firebaseConfig = {
          apiKey: "AIzaSyC94upmNINDoy1H68ctMOn-zPJmf2qcXlo",
          authDomain: "yarmokstore-33cdb.firebaseapp.com",
          projectId: "yarmokstore-33cdb",
          storageBucket: "yarmokstore-33cdb.appspot.com",
          messagingSenderId: "825824630041",
          appId: "1:825824630041:web:235a2e70ad548b2eb22188",
          measurementId: "G-8PQMJ4P9B1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
    </script>
</head>
<body>
<!-- ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø© ÙƒÙ…Ø§ Ù‡ÙŠ ... -->

<script>
    let tempImg = ""; 
    let receiptImg = "";
    let readyCartTotal = 0;

    // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¨ÙˆØª ÙŠØ§Ù‚ÙˆØª Ù„Ù… ØªØªØºÙŠØ±
    function toggleYaqoot() { const chat = document.getElementById('yaqoot_chat'); chat.style.display = chat.style.display === 'block' ? 'none' : 'block'; }
    function yaqootReply(type) {
        const text = document.getElementById('chat_text');
        if(type === 'policy') {
            text.innerHTML = "<b>ğŸ›¡ï¸ Ø¶Ù…Ø§Ù† Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ:</b> Ù†Ø¶Ù…Ù† Ù„Ùƒ Ø§Ù„Ù…Ù‚Ø§Ø³ 100%. Ø¥Ø°Ø§ ÙˆØ¬Ø¯ Ø£ÙŠ Ø§Ø®ØªÙ„Ø§ÙØŒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù…Ø¬Ø§Ù†ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹ Ø®Ù„Ø§Ù„ 3 Ø£ÙŠØ§Ù…. Ù‡ÙŠØ¨ØªÙƒ Ù„Ø§ ØªÙ‚Ø¨Ù„ Ø§Ù„Ø®Ø·Ø£.";
        } else if(type === 'offer') {
            text.innerHTML = "<b>ğŸ Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø´:</b> Ø¹Ù†Ø¯ Ø¯ÙØ¹ ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù‚Ø¯Ù…Ø§Ù‹ØŒ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ (ØªØ·Ø±ÙŠØ² ÙŠØ¯ÙˆÙŠ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø±Ù‚Ø¨Ø©) Ø£Ùˆ (Ø¹Ù„Ø¨Ø© ÙƒØ¨ÙƒØ§Øª ÙØ§Ø®Ø±Ø©) Ù‡Ø¯ÙŠØ© Ù…Ù† Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ.";
        } else if(type === 'about') {
            text.innerHTML = "<b>ğŸ“œ Ù‚ØµØ© Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ:</b> Ø¨Ø¯Ø£Øª Ø±Ø­Ù„ØªÙ†Ø§ ÙÙŠ 2002 Ø¹Ù„Ù‰ ÙŠØ¯ Ø§Ù„ÙˆØ§Ù„Ø¯ Ø§Ù„Ù…Ø¤Ø³Ø³ØŒ ØªØ¹Ù„Ù…Ù†Ø§ Ø£Ù† Ø§Ù„Ø«ÙˆØ¨ Ù„ÙŠØ³ Ù…Ø¬Ø±Ø¯ Ù‚Ø·Ø¹Ø© Ù‚Ù…Ø§Ø´ØŒ Ø¨Ù„ Ù‡Ùˆ Ø´Ø®ØµÙŠØ© Ø§Ù„Ø±Ø¬Ù„. Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ù†Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø±Ø«.";
        }
    }

    function openAdmin() { if(prompt("ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:") === "1234") document.getElementById('adminPanel').style.display='flex'; }
    function closeAdmin() { document.getElementById('adminPanel').style.display='none'; }

    // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
    function encodeImg(i) { let r = new FileReader(); r.onload = (e) => tempImg = e.target.result; r.readAsDataURL(i.files[0]); }
    function encodeReceipt(i) { let r = new FileReader(); r.onload = (e) => receiptImg = e.target.result; r.readAsDataURL(i.files[0]); }

    function switchMainTab(t) {
        document.querySelectorAll('.section, .tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('section_'+t).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // Ø¯Ø§Ù„Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Firebase
    async function saveProduct() {
        const cat = document.getElementById('adm_cat').value;
        const title = document.getElementById('adm_title').value;
        const newP = document.getElementById('adm_new').value;
        const fileInput = document.getElementById('adm_file');
        const file = fileInput.files[0];

        let imgURL = "";
        if (file) {
            const storageRef = storage.ref('products/' + file.name);
            await storageRef.put(file);
            imgURL = await storageRef.getDownloadURL();
        } else {
            imgURL = tempImg; // ÙƒÙˆØ¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ùˆ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
        }

        if (cat === 'logo') {
            document.getElementById('store_logo').src = imgURL;
        } else {
            await db.collection(cat === 'fabric' ? 'fabrics' : 'ready').add({
                cat: cat,
                title: title,
                newPrice: newP,
                img: imgURL
            });
        }

        alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­");
        filterReady('all');
        closeAdmin();
    }

    // Ø¹Ø±Ø¶ Ù‚Ù…Ø§Ø´ ÙØ§ÙŠØ±Ø¨ÙŠØ³ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
    async function openFabricModal() {
        const list = document.getElementById('modal_fabric_list');
        const snapshot = await db.collection('fabrics').get();
        const fabrics = snapshot.docs.map(doc => doc.data());
        list.innerHTML = fabrics.length ? fabrics.map(f => `
            <div style="border:1px solid #eee; padding:8px; text-align:center; cursor:pointer; border-radius:12px; transition:0.3s;" onclick="confirmFabricSelection('${f.title}', ${f.newPrice}, '${f.img}')">
                <img src="${f.img}" style="width:100%; height:80px; object-fit:cover; border-radius:8px;">
                <div style="font-size:11px; font-weight:bold; margin-top:5px;">${f.title}</div>
                <div style="font-size:11px; color:green;">${f.newPrice} Ø±ÙŠØ§Ù„</div>
            </div>
        `).join('') : '<p style="grid-column:1/-1; text-align:center;">Ù„Ø§ØªÙˆØ¬Ø¯ Ø£Ù‚Ù…Ø´Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
        document.getElementById('fabricModal').style.display = 'flex';
    }

    function confirmFabricSelection(name, price, img) {
        const id = Date.now();
        const card = document.createElement('div');
        card.className = 'selected-thobe-card';
        card.id = `thobe_${id}`;
        card.innerHTML = `
            <button type="button" class="remove-card" onclick="removeThobe(${id})">Ã—</button>
            <div style="display:flex; gap:12px; align-items:center;">
                <img src="${img}" style="width:50px; height:50px; border-radius:8px; object-fit:cover; border:1px solid var(--gold);">
                <div><b>Ø«ÙˆØ¨: ${name}</b><br><span style="color:green; font-size:13px;">${price} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</span></div>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:15px;">
                <select class="thobe-opt"><option>Ù‚Ù„Ø§Ø¨ Ù…Ù„ÙƒÙŠ</option><option>Ù‚Ù„Ø§Ø¨ ÙØ±Ù†Ø³ÙŠ</option><option>ØµÙŠÙ†ÙŠ</option><option>Ø³Ø§Ø¯Ø© Ù…Ø±Ø¨Ø¹</option></select>
                <select class="thobe-opt"><option>ÙƒØ¨Ùƒ Ù‚Ù…Ø§Ø´</option><option>ÙƒØ¨Ùƒ Ø­Ø´Ùˆ</option><option>Ø³Ø§Ø¯Ø©</option></select>
                <select class="thobe-opt"><option>ÙƒØ¨Ø³ Ø¸Ø§Ù‡Ø±</option><option>Ø²Ø±Ø§Ø± Ù…Ø®ÙÙŠ</option><option>Ø³Ø­Ø§Ø¨ VIP</option></select>
                <select class="thobe-opt"><option>Ù‚ØµØ© Ù‚Ø·Ø±ÙŠ</option><option>Ù‚ØµØ© Ø³Ø¹ÙˆØ¯ÙŠ</option><option>Ù‚ØµØ© ÙƒÙˆÙŠØªÙŠ</option></select>
            </div>
            <input type="hidden" class="item-price" value="${price}">
        `;
        document.getElementById('tailor_list').appendChild(card);
        calcGrandTotal();
        document.getElementById('fabricModal').style.display = 'none';
    }

    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ³
    async function filterReady(type, btn) {
        if(btn) {
            document.querySelectorAll('.ready-type-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        const display = document.getElementById('ready_display');
        const snapshot = await db.collection('ready').get();
        let items = snapshot.docs.map(doc => doc.data());
        if (type !== 'all') items = items.filter(i => i.cat === type);

        display.innerHTML = items.length ? items.map(i => `
            <div class="product-card">
                <img src="${i.img}">
                <div style="padding:10px;">
                    <div style="font-size:13px; font-weight:bold;">${i.title}</div>
                    <span class="new-price">${i.newPrice} Ø±ÙŠØ§Ù„</span>
                    <button onclick="addReadyToCart(${i.newPrice})" style="width:100%; margin-top:8px; background:var(--gold); border:none; color:white; border-radius:8px; font-size:12px; padding:8px; cursor:pointer; font-weight:bold;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ù„Ø¨</button>
                </div>
            </div>
        `).join('') : '<p style="grid-column:1/-1; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</p>';
    }

    function addReadyToCart(p) { readyCartTotal += parseInt(p); calcGrandTotal(); alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ù‡ÙŠØ¨ØªÙƒ"); }
    function removeThobe(id) { document.getElementById(`thobe_${id}`).remove(); calcGrandTotal(); }

    function calcGrandTotal() {
        let t = readyCartTotal;
        document.querySelectorAll('.item-price').forEach(i => t += parseInt(i.value || 0));
        document.getElementById('final_total').innerText = t.toLocaleString();
    }

    function selectPayment(m, d, el) {
        document.querySelectorAll('.pay-card-ui').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('account_display').style.display = 'block';
        document.getElementById('account_number').innerText = d;
        document.getElementById('selected_payment').value = m + " (" + d + ")";
        document.getElementById('receipt_section').style.display = 'block';
    }

    function submitOrder() {
        const name = document.getElementById('c_name').value;
        const total = document.getElementById('final_total').innerText;
        if (!name || total === "0") return alert("Ø£ÙƒÙ…Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ§Ø®ØªØ± Ø«ÙˆØ¨Ø§Ù‹ ÙŠÙ„ÙŠÙ‚ Ø¨Ùƒ Ø£ÙˆÙ„Ø§Ù‹");

        const orderData = {
            name: name,
            phone: document.getElementById('c_phone').value,
            total: total,
            payment: document.getElementById('selected_payment').value,
            date: new Date().toLocaleString('ar-YE'),
            source: "Ù…ØªØ¬Ø± Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø­Ø¯ÙŠØ« 2026"
        };

        const webhookUrl = 'https://ali991278.app.n8n.cloud/webhook-test/e4bcc169-93c0-42c5-8226-528f3c6a72e3';
        
        fetch(webhookUrl, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(orderData)
        })
        .then(() => {
            alert("Ø§ÙƒØªÙ…Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­.\n\nØ³Ù†ØµÙ†Ø¹ Ø£Ù†Ø§Ù‚ØªÙƒ ÙÙŠ Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ù„Ù„Ø®ÙŠØ§Ø·Ø© Ø¨Ø¯Ù‚Ø© ØªÙ„ÙŠÙ‚ Ø¨Ùƒ.");
            location.reload();
        })
        .catch(() => alert("ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø·Ù„Ø¨Ùƒ.. Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒ Ø¨Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ"));
    }

    // Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„ Ù„Ù„ØµÙØ­Ø©ØŒ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ³
    document.addEventListener('DOMContentLoaded', () => {
        filterReady('all');
    });
</script>
</body>
</html>
