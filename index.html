<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ù„Ù„Ø®ÙŠØ§Ø·Ø© - Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --gold: #d4af37; --brown: #5d4037; --bg: #fdfbf7; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); margin: 0; padding: 10px; direction: rtl; }
        
        .main-container { max-width: 600px; margin: auto; background: var(--white); border-radius: 20px; border: 1px solid var(--gold); box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; position: relative; }
        
        .header { text-align: center; padding: 20px; border-bottom: 2px solid var(--gold); }
        .logo { width: 160px; margin-bottom: 10px; }
        .cust-info { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; background: #fff9eb; }
        .cust-info input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; outline: none; width: 100%; box-sizing: border-box;}

        .main-tabs { display: flex; background: #eee; }
        .tab-btn { flex: 1; padding: 15px; border: none; cursor: pointer; font-weight: bold; background: #eee; color: #666; transition: 0.3s; font-size: 13px; }
        .tab-btn.active { background: var(--gold); color: white; }

        .section { display: none; padding: 15px; min-height: 400px; }
        .section.active { display: block; }

        .measure-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 15px 0; background: #f9f9f9; padding: 10px; border-radius: 10px; }
        .measure-grid div { text-align: center; }
        .measure-grid label { font-size: 11px; color: var(--brown); font-weight: bold; display: block; margin-bottom: 4px; }
        .measure-grid input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; text-align: center; box-sizing: border-box; font-size: 13px; }

        .items-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .product-card { border: 1px solid #eee; border-radius: 15px; overflow: hidden; background: white; text-align: center; padding-bottom: 10px; }
        .product-card img { width: 100%; height: 150px; object-fit: cover; }
        .new-price { color: #28a745; font-weight: bold; font-size: 15px; }

        /* Ø¨ÙˆØª Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ */
        #bot_box { background: #f0f0f0; border-radius: 15px; padding: 15px; margin-top: 10px; border: 1px solid var(--gold); }
        .bot-msg { background: var(--brown); color: white; padding: 10px; border-radius: 10px; margin-bottom: 10px; font-size: 14px; line-height: 1.5; }
        .bot-btn { background: white; border: 1px solid var(--brown); padding: 8px; border-radius: 20px; margin: 5px; cursor: pointer; font-size: 12px; transition: 0.3s; }
        .bot-btn:hover { background: var(--gold); color: white; }

        /* ØµÙØ­Ø© Ù…Ù† Ù†Ø­Ù† */
        .about-content { text-align: center; line-height: 1.8; color: #444; }
        .about-card { background: #fff9eb; padding: 20px; border-radius: 15px; border-right: 5px solid var(--gold); margin-top: 15px; text-align: right; }

        .selected-thobe-card { background: #fff9eb; border: 1px solid var(--gold); border-radius: 15px; padding: 15px; margin-bottom: 15px; position: relative; }
        .remove-card { position: absolute; top: 10px; left: 10px; background: #ff4d4d; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; }
        .thobe-opt { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; font-size: 12px; margin-top: 5px; background: white; }
        .pay-card { border: 1px solid #ddd; padding: 12px; border-radius: 12px; text-align: center; cursor: pointer; background: #fff; }
        
        .admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center; }
        .admin-content { background: #222; color: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto; }
        
        .btn-send { width: 100%; padding: 18px; background: var(--brown); color: white; border: none; border-radius: 15px; font-size: 18px; font-weight: bold; margin-top: 20px; cursor: pointer; }
        .settings-btn { position: fixed; bottom: 20px; left: 20px; background: var(--white); border: 1px solid var(--gold); border-radius: 50%; width: 50px; height: 50px; cursor: pointer; z-index: 1000; font-size: 24px;}
    </style>
</head>
<body>

<button class="settings-btn" onclick="openAdmin()">âš™ï¸</button>

<div class="main-container" id="app_body">
    <div class="header">
        <img src="https://i.ibb.co/C3YFp0k7/688339f4-1296-48c0-bc66-3be039832675.png" class="logo" id="store_logo">
        <h2 style="margin:0; color:var(--brown)">Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ù„Ù„Ø®ÙŠØ§Ø·Ø© Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ©</h2>
    </div>

    <div class="cust-info">
        <input type="text" id="c_name" placeholder="Ø¥Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„">
        <input type="tel" id="c_phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    </div>

    <div class="main-tabs">
        <button class="tab-btn active" onclick="switchMainTab('tailor')">Ø§Ù„ØªÙØµÙŠÙ„</button>
        <button class="tab-btn" onclick="switchMainTab('ready')">Ø§Ù„Ø¬Ø§Ù‡Ø²</button>
        <button class="tab-btn" onclick="switchMainTab('bot')">Ø¨ÙˆØª Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ</button>
        <button class="tab-btn" onclick="switchMainTab('about')">Ù…Ù† Ù†Ø­Ù†</button>
    </div>

    <div id="section_tailor" class="section active">
        <h4 style="margin:0 0 10px 0; color:var(--brown)">Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø¨Ø§Ù„Ù‡Ù†Ø´)</h4>
        <div class="measure-grid">
            <div><label>Ø§Ù„Ø·ÙˆÙ„</label><input type="number" step="0.1" id="m_t"></div>
            <div><label>Ø§Ù„ÙƒØªÙ</label><input type="number" step="0.1" id="m_k"></div>
            <div><label>Ø§Ù„ÙŠØ¯</label><input type="number" step="0.1" id="m_y"></div>
            <div><label>Ø§Ù„ØµØ¯Ø±</label><input type="number" step="0.1" id="m_s"></div>
            <div><label>Ø§Ù„Ø±Ù‚Ø¨Ø©</label><input type="number" step="0.1" id="m_r"></div>
            <div><label>ÙˆØ³Ø· ÙŠØ¯</label><input type="number" step="0.1" id="m_wy"></div>
            <div><label>Ø§Ù„ÙƒØ¨Ùƒ</label><input type="number" step="0.1" id="m_kb"></div>
            <div><label>Ø§Ù„Ø®Ø·ÙˆØ©</label><input type="number" step="0.1" id="m_kh"></div>
        </div>
        <button type="button" style="width:100%; padding:15px; background:#fff; border:2px dashed var(--gold); border-radius:12px; color:var(--gold); font-weight:bold; cursor:pointer;" onclick="openFabricModal()">+ Ø¥Ø¶Ø§ÙØ© Ø«ÙˆØ¨ ØªÙØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
        <div id="tailor_list" style="margin-top:15px;"></div>
    </div>

    <div id="section_ready" class="section">
        <div id="ready_display" class="items-grid"></div>
    </div>

    <div id="section_bot" class="section">
        <div id="bot_box">
            <div class="bot-msg" id="bot_chat">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø°ÙƒÙŠØ©! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø¢Ù„ÙŠØŒ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
            <div id="bot_options">
                <button class="bot-btn" onclick="botAnswer('fabrics')">Ø´Ø±Ø­ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ù‚Ù…Ø´Ø©</button>
                <button class="bot-btn" onclick="botAnswer('neck')">Ø´Ø±Ø­ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø±Ù‚Ø¨Ø§Øª</button>
                <button class="bot-btn" onclick="botAnswer('cuff')">Ø´Ø±Ø­ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙƒØ¨ÙƒØ§Øª</button>
                <button class="bot-btn" onclick="botAnswer('location')">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­Ù„</button>
            </div>
        </div>
    </div>

    <div id="section_about" class="section about-content">
        <img src="https://i.ibb.co/C3YFp0k7/688339f4-1296-48c0-bc66-3be039832675.png" style="width:80px; margin-top:20px;">
        <h3>Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ù„Ù„Ø®ÙŠØ§Ø·Ø© Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ©</h3>
        <p>Ù†Ø­Ù† Ù„Ø³Ù†Ø§ Ù…Ø¬Ø±Ø¯ Ù…Ø­Ù„ Ø®ÙŠØ§Ø·Ø©ØŒ Ù†Ø­Ù† Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ø£Ù†Ø§Ù‚Ø© Ø§Ù„ÙŠÙ…Ù†ÙŠØ© Ø§Ù„Ø£ØµÙŠÙ„Ø© Ø§Ù„Ù…Ù…Ø²ÙˆØ¬Ø© Ø¨Ø§Ù„Ø­Ø¯Ø§Ø«Ø©.</p>
        <div class="about-card">
            <b>ğŸ“ Ø±Ø¤ÙŠØªÙ†Ø§:</b> ØªÙ‚Ø¯ÙŠÙ… Ø£Ø¬ÙˆØ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ù‚Ù…Ø´Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© ÙˆØªÙØµÙŠÙ„Ù‡Ø§ Ø¨Ø£ÙŠØ¯ÙŠ Ø£Ù…Ù‡Ø± Ø§Ù„Ø®ÙŠØ§Ø·ÙŠÙ† Ù„Ù†Ø¶Ù…Ù† Ù„Ùƒ Ù…Ø¸Ù‡Ø±Ø§Ù‹ ÙŠÙ„ÙŠÙ‚ Ø¨Ù…Ù‚Ø§Ù…Ùƒ.
        </div>
        <div class="about-card">
            <b>ğŸ§µ ØªÙ…ÙŠØ²Ù†Ø§:</b> ØªØ®ØµØµÙ†Ø§ ÙÙŠ ÙƒØ§ÙØ© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø«ÙŠØ§Ø¨ (Ù‚Ø·Ø±ÙŠØŒ Ø³Ø¹ÙˆØ¯ÙŠØŒ ÙƒÙˆÙŠØªÙŠØŒ Ø¹Ù…Ø§Ù†ÙŠ) Ù…Ø¹ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø¨Ø£Ø¯Ù‚ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ù‚Ø¨Ø§Øª ÙˆØ§Ù„Ø¬Ø¨Ø§Ø²ÙŠØ±.
        </div>
        <p style="font-size:12px; margin-top:20px;">Ø®Ø¯Ù…ØªÙƒÙ… Ø´Ø±Ù Ù„Ù†Ø§ Ø¯Ø§Ø¦Ù…Ø§Ù‹.</p>
    </div>

    <div id="payment_ui" style="padding:15px; background:#fff; border-top:5px solid #eee;">
        <h4 style="margin:0 0 10px 0; color:var(--brown); font-size:14px;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</h4>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <div class="pay-card" onclick="selectPayment('Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ', 'Ø­Ø³Ø§Ø¨ Ø±ÙŠØ§Ù„: 3005374854', this)">Ø¨Ù†Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ</div>
            <div class="pay-card" onclick="selectPayment('Ø¬ÙŠØ¨', 'Ù†Ù‚Ø·Ø©: 595720', this)">Ù…Ø­ÙØ¸Ø© Ø¬ÙŠØ¨</div>
        </div>
        <div id="account_display" style="display:none; background:#fdfbf7; border:1px dashed var(--gold); padding:10px; border-radius:10px; text-align:center; margin-top:10px;">
            <div id="account_number" style="font-size:16px; font-weight:bold; color:var(--brown);"></div>
            <input type="file" id="receipt_file" accept="image/*" onchange="encodeReceipt(this)" style="margin-top:10px; font-size:10px;">
        </div>
        <input type="hidden" id="selected_payment" value="Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯">
        <div style="background:var(--brown); color:white; padding:15px; text-align:center; border-radius:10px; margin-top:15px;">
            <h3 style="margin:0;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="final_total">0</span> Ø±ÙŠØ§Ù„</h3>
        </div>
        <button type="button" class="btn-send" onclick="submitOrder()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹</button>
    </div>
</div>

<div id="adminPanel" class="admin-panel">
    <div class="admin-content">
        <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
        <select id="adm_cat"><option value="fabric">Ù‚Ù…Ø§Ø´ ØªÙØµÙŠÙ„</option><option value="thobe_r">Ø«ÙˆØ¨ Ø¬Ø§Ù‡Ø²</option><option value="logo">ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø¹Ø§Ø±</option></select>
        <input type="file" onchange="encodeImg(this)"><input type="text" id="adm_title" placeholder="Ø§Ù„Ø§Ø³Ù…"><input type="number" id="adm_new" placeholder="Ø§Ù„Ø³Ø¹Ø±">
        <button onclick="saveProduct()" style="width:100%; padding:15px; background:var(--gold); color:white; border:none; border-radius:10px;">Ø­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠ</button>
        <button onclick="closeAdmin()" style="width:100%; margin-top:10px; color:#ccc; background:none; border:none;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="fabricModal" class="admin-panel" style="z-index:9999;">
    <div style="background:white; width:90%; max-width:400px; padding:20px; border-radius:15px; max-height:80vh; overflow-y:auto;">
        <h3 style="text-align:center;">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ù…Ø§Ø´</h3>
        <div id="modal_fabric_list" class="items-grid"></div>
        <button onclick="document.getElementById('fabricModal').style.display='none'" style="width:100%; margin-top:15px; padding:10px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAT4_kbAgDL8Jw5V2jRj3mqyD-lA84ECjY", databaseURL: "https://alyarmok-store-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let db = { fabrics: [], ready: [] };
    let tempImg = ""; let receiptImg = "";
    let selectedTailorItems = []; let readyCartTotal = 0;

    database.ref('products').on('value', (s) => {
        const data = s.val(); db.fabrics = []; db.ready = [];
        if(data) { for(let id in data) { if(data[id].cat === 'fabric') db.fabrics.push(data[id]); else db.ready.push(data[id]); } }
        renderReady();
    });

    function switchMainTab(t) {
        document.querySelectorAll('.section, .tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('section_'+t).classList.add('active');
        event.currentTarget.classList.add('active');
        // Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯ÙØ¹ ÙÙŠ ØµÙØ­Ø§Øª Ø§Ù„Ø¨ÙˆØª ÙˆÙ…Ù† Ù†Ø­Ù† Ù„ØªÙˆÙÙŠØ± Ù…Ø³Ø§Ø­Ø©
        document.getElementById('payment_ui').style.display = (t === 'bot' || t === 'about') ? 'none' : 'block';
    }

    function botAnswer(type) {
        let msg = "";
        if(type === 'fabrics') msg = "Ù†ÙˆÙØ± Ø£Ù‚Ù…Ø´Ø© Ù‚Ø·Ù†ÙŠØ© Ø¨Ø§Ø±Ø¯Ø©ØŒ ØªØªØ±ÙˆÙ† ÙŠØ§Ø¨Ø§Ù†ÙŠØŒ ÙˆØ³Ù„Ùƒ Ù†Ø§Ø¹Ù…. Ø§Ù„Ø£Ù‚Ø·Ø§Ù† ØªÙ†Ø§Ø³Ø¨ Ø§Ù„ØµÙŠÙ ÙˆØ§Ù„ØªØªØ±ÙˆÙ† Ù„Ù„Ø£Ù†Ø§Ù‚Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©.";
        if(type === 'neck') msg = "Ø§Ù„Ù‚Ù„Ø§Ø¨ Ø§Ù„Ù…Ù„ÙƒÙŠ Ù‡Ùˆ Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹ Ù„Ù„Ù…Ù†Ø§Ø³Ø¨Ø§ØªØŒ Ø¨ÙŠÙ†Ù…Ø§ Ø§Ù„Ø±Ù‚Ø¨Ø© Ø§Ù„ØµÙŠÙ†ÙŠ ØªØ¹Ø·ÙŠ Ø·Ø§Ø¨Ø¹Ø§Ù‹ Ø¹ØµØ±ÙŠØ§Ù‹ ÙˆÙ…Ø±ÙŠØ­Ø§Ù‹.";
        if(type === 'cuff') msg = "ÙƒØ¨Ùƒ Ø§Ù„Ù‚Ù…Ø§Ø´ ÙŠÙƒÙˆÙ† Ù…Ù† Ù†ÙØ³ Ù„ÙˆÙ† Ø§Ù„Ø«ÙˆØ¨ØŒ Ø£Ù…Ø§ ÙƒØ¨Ùƒ Ø§Ù„Ø­Ø´Ùˆ ÙÙ‡Ùˆ Ø§Ù„Ù…Ø®ØµØµ Ù„ØªØ±ÙƒÙŠØ¨ Ø§Ù„ÙƒØ¨ÙƒØ§Øª Ø§Ù„Ù…Ø¹Ø¯Ù†ÙŠØ© Ø§Ù„ÙØ§Ø®Ø±Ø©.";
        if(type === 'location') msg = "Ù…Ø­Ù„Ù†Ø§ ÙŠØ±Ø­Ø¨ Ø¨ÙƒÙ…ØŒ ØµÙ†Ø¹Ø§Ø¡ - (ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¯Ù‚Ø© Ù‡Ù†Ø§).";
        document.getElementById('bot_chat').innerText = msg;
    }

    function renderReady() {
        const div = document.getElementById('ready_display');
        div.innerHTML = db.ready.map(i => `<div class="product-card"><img src="${i.img}"><h4>${i.title}</h4><p>${i.newPrice} Ø±ÙŠØ§Ù„</p><button onclick="readyCartTotal+=parseInt(${i.newPrice}); calcGrandTotal(); alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©');">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ù„Ø¨</button></div>`).join('');
    }

    function openFabricModal() {
        const div = document.getElementById('modal_fabric_list');
        div.innerHTML = db.fabrics.map(f => `<div class="pay-card" onclick="addTailorItem('${f.title}', ${f.newPrice}, '${f.img}')"><img src="${f.img}" style="width:100%; height:60px; object-fit:cover;"><br>${f.title}</div>`).join('');
        document.getElementById('fabricModal').style.display='flex';
    }

    function addTailorItem(name, price, img) {
        selectedTailorItems.push({ name, price, img, neck: 'Ù‚Ù„Ø§Ø¨ Ù…Ù„ÙƒÙŠ', cuff: 'ÙƒØ¨Ùƒ Ù‚Ù…Ø§Ø´', pocket: 'ÙƒØ¨Ø³ Ø¸Ø§Ù‡Ø±', style: 'Ù‚Ø·Ø±ÙŠ' });
        renderTailorList();
        document.getElementById('fabricModal').style.display='none';
    }

    function renderTailorList() {
        document.getElementById('tailor_list').innerHTML = selectedTailorItems.map((item, i) => `
            <div class="selected-thobe-card">
                <button class="remove-card" onclick="selectedTailorItems.splice(${i},1); renderTailorList();">Ã—</button>
                <b>Ù‚Ù…Ø§Ø´: ${item.name}</b>
                <div class="design-options" style="display:grid; grid-template-columns:1fr 1fr; gap:5px; margin-top:10px;">
                    <select class="thobe-opt" onchange="selectedTailorItems[${i}].neck=this.value"><option>Ù‚Ù„Ø§Ø¨ Ù…Ù„ÙƒÙŠ</option><option>Ù‚Ù„Ø§Ø¨ ÙØ±Ù†Ø³ÙŠ</option><option>Ù‚Ù„Ø§Ø¨ Ø¯Ø§Ø¦Ø±ÙŠ</option><option>Ø³Ø§Ø¯Ø© Ù…Ø±Ø¨Ø¹</option><option>ØµÙŠÙ†ÙŠ</option></select>
                    <select class="thobe-opt" onchange="selectedTailorItems[${i}].cuff=this.value"><option>ÙƒØ¨Ùƒ Ù‚Ù…Ø§Ø´</option><option>ÙƒØ¨Ùƒ Ø­Ø´Ùˆ</option><option>Ø³Ø§Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø²Ø±Ø§Ø±</option></select>
                    <select class="thobe-opt" onchange="selectedTailorItems[${i}].pocket=this.value"><option>ÙƒØ¨Ø³ Ø¸Ø§Ù‡Ø±</option><option>Ø²Ø±Ø§Ø± Ù…Ø®ÙÙŠ</option><option>Ø³Ø­Ø§Ø¨ VIP</option></select>
                    <select class="thobe-opt" onchange="selectedTailorItems[${i}].style=this.value"><option>Ù‚Ø·Ø±ÙŠ</option><option>Ø³Ø¹ÙˆØ¯ÙŠ</option><option>ÙƒÙˆÙŠØªÙŠ</option><option>Ø¹Ù…Ø§Ù†ÙŠ</option></select>
                </div>
            </div>`).join('');
        calcGrandTotal();
    }

    function calcGrandTotal() {
        let total = readyCartTotal;
        selectedTailorItems.forEach(i => total += parseInt(i.price));
        document.getElementById('final_total').innerText = total.toLocaleString();
    }

    function selectPayment(m, d, el) {
        document.querySelectorAll('.pay-card').forEach(c => c.style.border='1px solid #ddd');
        el.style.border='2px solid var(--gold)';
        document.getElementById('account_display').style.display='block';
        document.getElementById('account_number').innerText = d;
        document.getElementById('selected_payment').value = m;
    }

    function encodeImg(i) { let r = new FileReader(); r.onload = (e) => tempImg = e.target.result; r.readAsDataURL(i.files[0]); }
    function encodeReceipt(i) { let r = new FileReader(); r.onload = (e) => receiptImg = e.target.result; r.readAsDataURL(i.files[0]); }
    function openAdmin() { if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:") === "1234") document.getElementById('adminPanel').style.display='flex'; }
    function closeAdmin() { document.getElementById('adminPanel').style.display='none'; }
    function saveProduct() {
        const cat = document.getElementById('adm_cat').value;
        const title = document.getElementById('adm_title').value;
        const newPrice = document.getElementById('adm_new').value;
        database.ref('products').push({ cat, title, newPrice, img: tempImg }).then(() => { alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); closeAdmin(); });
    }

    function submitOrder() {
        const name = document.getElementById('c_name').value;
        if(!name || (selectedTailorItems.length === 0 && readyCartTotal === 0)) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        
        const orderData = {
            customer: name,
            phone: document.getElementById('c_phone').value,
            total: document.getElementById('final_total').innerText,
            payment: document.getElementById('selected_payment').value,
            receipt: receiptImg,
            measures: { t: document.getElementById('m_t').value, k: document.getElementById('m_k').value, y: document.getElementById('m_y').value, s: document.getElementById('m_s').value, r: document.getElementById('m_r').value, wy: document.getElementById('m_wy').value, kb: document.getElementById('m_kb').value, kh: document.getElementById('m_kh').value },
            tailorItems: selectedTailorItems,
            timestamp: new Date().toISOString()
        };

        database.ref('orders').push(orderData).then(() => {
            document.getElementById('app_body').innerHTML = `<div style="text-align:center; padding:50px;"><h2>âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹</h2><p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ Ù…Ù† Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ</p><button onclick="location.reload()">Ø§Ù„Ø¹ÙˆØ¯Ø©</button></div>`;
        });
    }
</script>
</body>
</html>
