<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø­Ø¯ÙŠØ« - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --gold: #d4af37; --brown: #5d4037; --bg: #fdfbf7; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); margin: 0; padding: 0; direction: rtl; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { text-align: center; padding: 30px; background: #fff; border-bottom: 3px solid var(--gold); }
        #main_logo { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 2px solid var(--gold); }

        .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; padding: 20px; }
        
        /* Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .cust-data { background: #fff9eb; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #f0e6d2; }
        .cust-data input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }

        /* Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª */
        .measure-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .measure-grid input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; text-align: center; }
        .measure-grid label { font-size: 11px; display: block; text-align: center; color: var(--brown); font-weight: bold; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
        .add-btn-large { width: 100%; padding: 20px; background: white; border: 2px dashed var(--gold); color: var(--gold); border-radius: 15px; font-weight: bold; cursor: pointer; font-size: 16px; margin-bottom: 15px; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
        #adminPanel { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:10000; overflow-y:auto; padding: 20px; box-sizing: border-box; }
        .admin-form { background: #f4f4f4; padding: 15px; border-radius: 15px; margin-bottom: 20px; }
        .admin-form input, .admin-form select, .admin-form textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 8px; }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„) */
        .product-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:5000; overflow-y:auto; padding:20px; box-sizing:border-box; }
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .item-card { background: white; border-radius: 12px; overflow: hidden; text-align: center; padding-bottom: 10px; }
        .item-card img { width: 100%; height: 150px; object-fit: cover; }
        .price-old { text-decoration: line-through; color: red; font-size: 11px; }
        .price-new { color: green; font-weight: bold; font-size: 14px; }

        .tailor-opts { background: #f9f9f9; padding: 10px; border-radius: 10px; margin-top: 10px; font-size: 12px; }
        .tailor-opts select { width: 100%; padding: 5px; margin-bottom: 5px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="header">
    <img src="" id="main_logo" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„">
    <h2 id="store_name">Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø­Ø¯ÙŠØ« Ù„Ù„Ø®ÙŠØ§Ø·Ø©</h2>
</div>

<div class="container">
    <div class="cust-data">
        <h4 style="margin-top:0;">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆÙ…Ù‚Ø§Ø³Ø§ØªÙ‡:</h4>
        <input type="text" id="c_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ">
        <input type="tel" id="c_phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆØ§ØªØ³Ø§Ø¨)">
        
        <div class="measure-grid">
            <div><label>Ø·ÙˆÙ„</label><input type="number" class="m-val"></div>
            <div><label>ÙƒØªÙ</label><input type="number" class="m-val"></div>
            <div><label>ÙŠØ¯</label><input type="number" class="m-val"></div>
            <div><label>ØµØ¯Ø±</label><input type="number" class="m-val"></div>
            <div><label>Ø±Ù‚Ø¨Ø©</label><input type="number" class="m-val"></div>
            <div><label>ÙˆØ³Ø·</label><input type="number" class="m-val"></div>
            <div><label>ÙƒØ¨Ùƒ</label><input type="number" class="m-val"></div>
            <div><label>Ø®Ø·ÙˆØ©</label><input type="number" class="m-val"></div>
        </div>
    </div>

    <button class="add-btn-large" onclick="openProducts('fabric')">â• Ø¥Ø¶Ø§ÙØ© Ù‚Ù…Ø§Ø´ ØªÙØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
    <button class="add-btn-large" onclick="openProducts('ready')">â• Ø¥Ø¶Ø§ÙØ© Ø«ÙŠØ§Ø¨ Ø¬Ø§Ù‡Ø²Ø© / Ø´ÙŠÙ„Ø§Ù† / Ø£ÙƒÙˆØ§Øª</button>

    <div id="cart_area"></div>

    <div id="final_box" style="margin-top:20px; text-align:center; background:var(--brown); color:white; padding:20px; border-radius:15px;">
        <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total_price">0</span> Ø±ÙŠØ§Ù„</h3>
        <button onclick="submitOrder()" style="width:100%; padding:15px; background:var(--gold); color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">ØªØ£ÙƒÙŠØ¯ Ù‡ÙŠØ¨Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>
</div>

<div id="productModal" class="product-modal">
    <div style="display:flex; justify-content:space-between; color:white; margin-bottom:20px;">
        <h3 id="modal_title">Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>
        <button onclick="closeProducts()" style="background:red; color:white; border:none; padding:10px; border-radius:5px;">Ø¥ØºÙ„Ø§Ù‚ X</button>
    </div>
    <div id="product_list" class="product-grid"></div>
</div>

<div id="adminPanel">
    <h2 style="text-align:center;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø®Ø²Ù† Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ</h2>
    
    <div class="admin-form">
        <h4>ğŸ–¼ï¸ ØªØºÙŠÙŠØ± Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„:</h4>
        <input type="file" id="logo_input" onchange="uploadLogo(this)">
    </div>

    <div class="admin-form">
        <h4>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯:</h4>
        <select id="adm_cat">
            <option value="fabric">Ø£Ù‚Ù…Ø´Ø© ØªÙØµÙŠÙ„</option>
            <option value="ready">Ø¬Ø§Ù‡Ø² (Ø«ÙŠØ§Ø¨/Ø´ÙŠÙ„Ø§Ù†/Ø£ÙƒÙˆØ§Øª)</option>
        </select>
        <input type="file" id="adm_file" onchange="encodeImg(this)">
        <input type="text" id="adm_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬/Ø§Ù„Ù‚Ù…Ø§Ø´">
        <textarea id="adm_desc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ (Ù†ÙˆØ¹ Ø§Ù„Ù‚Ù…Ø§Ø´ØŒ Ø§Ù„Ø¬ÙˆØ¯Ø©...)"></textarea>
        <input type="number" id="adm_old_price" placeholder="Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…">
        <input type="number" id="adm_new_price" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…">
        <button onclick="saveProduct()" style="width:100%; padding:12px; background:green; color:white; border:none; border-radius:8px;">Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¢Ù†</button>
    </div>

    <h4>ğŸ“‹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù„Ù„Ø­Ø°Ù):</h4>
    <div id="admin_items_list"></div>
    
    <button onclick="closeAdmin()" style="width:100%; padding:15px; background:#666; color:white; border:none; border-radius:10px; margin-top:20px;">Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<button onclick="checkAdmin()" style="position:fixed; bottom:10px; left:10px; background:none; border:none; font-size:20px; cursor:pointer; opacity:0.3;">âš™ï¸</button>

<script>
// --- ØªÙƒÙˆÙŠÙ† Firebase ---
const firebaseConfig = { databaseURL: "https://alyarmok-store-default-rtdb.firebaseio.com/" };
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let allProducts = [];
let cart = [];
let tempImg = "";

// Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª
database.ref('settings/logo').on('value', s => { document.getElementById('main_logo').src = s.val() || ''; });
database.ref('products').on('value', s => {
    allProducts = [];
    const data = s.val();
    if(data) for(let id in data) allProducts.push({...data[id], id});
    renderAdminList();
});

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
function checkAdmin() { if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:") === "1234") document.getElementById('adminPanel').style.display='block'; }
function closeAdmin() { document.getElementById('adminPanel').style.display='none'; }

function uploadLogo(input) {
    const reader = new FileReader();
    reader.onload = (e) => database.ref('settings/logo').set(e.target.result);
    reader.readAsDataURL(input.files[0]);
}

function encodeImg(input) {
    const reader = new FileReader();
    reader.onload = (e) => tempImg = e.target.result;
    reader.readAsDataURL(input.files[0]);
}

function saveProduct() {
    const name = document.getElementById('adm_name').value;
    const cat = document.getElementById('adm_cat').value;
    const desc = document.getElementById('adm_desc').value;
    const oldP = document.getElementById('adm_old_price').value;
    const newP = document.getElementById('adm_new_price').value;

    if(!tempImg || !name || !newP) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

    database.ref('products').push({ name, cat, desc, oldP, newP, img: tempImg })
    .then(() => { alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!"); tempImg=""; document.getElementById('adm_file').value=""; });
}

function deleteProduct(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) database.ref('products/'+id).remove(); }

function renderAdminList() {
    const list = document.getElementById('admin_items_list');
    list.innerHTML = allProducts.map(p => `
        <div style="background:#eee; padding:10px; margin-bottom:5px; display:flex; justify-content:space-between; align-items:center; border-radius:8px;">
            <span>${p.name} (${p.newP} Ø±ÙŠØ§Ù„)</span>
            <button onclick="deleteProduct('${p.id}')" style="background:red; color:white; border:none; border-radius:5px; padding:5px;">Ø­Ø°Ù</button>
        </div>
    `).join('');
}

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ¬Ø±
function openProducts(cat) {
    const list = document.getElementById('product_list');
    const filtered = allProducts.filter(p => p.cat === cat);
    list.innerHTML = filtered.map(p => `
        <div class="item-card">
            <img src="${p.img}">
            <div style="padding:10px;">
                <b style="font-size:14px;">${p.name}</b>
                <p style="font-size:11px; color:#666; margin:5px 0;">${p.desc}</p>
                <div><span class="price-old">${p.oldP}</span> <span class="price-new">${p.newP} Ø±ÙŠØ§Ù„</span></div>
                <button onclick="addToCart('${p.id}')" style="width:100%; margin-top:8px; background:var(--gold); color:white; border:none; border-radius:5px; padding:8px; cursor:pointer;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
            </div>
        </div>
    `).join('');
    document.getElementById('productModal').style.display = 'block';
}

function closeProducts() { document.getElementById('productModal').style.display = 'none'; }

function addToCart(id) {
    const p = allProducts.find(x => x.id === id);
    cart.push({...p, cartId: Date.now()});
    renderCart();
    closeProducts();
}

function renderCart() {
    const area = document.getElementById('cart_area');
    area.innerHTML = cart.map((p, idx) => `
        <div style="background:white; border:1px solid var(--gold); border-radius:15px; padding:15px; margin-bottom:10px; position:relative;">
            <button onclick="removeFromCart(${idx})" style="position:absolute; left:10px; top:10px; background:red; color:white; border:none; border-radius:50%; width:25px; height:25px;">Ã—</button>
            <div style="display:flex; gap:10px; align-items:center;">
                <img src="${p.img}" style="width:50px; height:50px; border-radius:8px;">
                <div><b>${p.name}</b><br><small>${p.newP} Ø±ÙŠØ§Ù„</small></div>
            </div>
            ${p.cat === 'fabric' ? `
            <div class="tailor-opts">
                <select class="t-opt"><option>Ø®ÙŠØ§Ø·Ø©: Ø³Ø¹ÙˆØ¯ÙŠ</option><option>Ù‚Ø·Ø±ÙŠ</option><option>ÙƒÙˆÙŠØªÙŠ</option><option>Ø¹Ù…Ø§Ù†ÙŠ</option></select>
                <select class="t-opt"><option>Ø±Ù‚Ø¨Ø©: Ù‚Ù„Ø§Ø¨ Ù…Ù„ÙƒÙŠ</option><option>Ù‚Ù„Ø§Ø¨ ÙØ±Ù†Ø³ÙŠ</option><option>Ù‚Ù„Ø§Ø¨ Ø¯Ø§Ø¦Ø±ÙŠ</option><option>ØµÙŠÙ†ÙŠ</option><option>Ø³Ø§Ø¯Ø© Ù…Ø±Ø¨Ø¹</option></select>
                <select class="t-opt"><option>ÙƒØ¨Ùƒ: Ù‚Ù…Ø§Ø´</option><option>Ø­Ø´Ùˆ</option><option>Ø³Ø§Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø²Ø±Ø§Ø±</option></select>
                <select class="t-opt"><option>Ø§Ù„ØµØ¯Ø±: ÙƒØ¨Ø³ Ø¸Ø§Ù‡Ø±</option><option>Ø²Ø±Ø§Ø± Ù…Ø®ÙÙŠ</option><option>Ø³Ø­Ø§Ø¨</option><option>ÙÙŠ Ø¢ÙŠ Ø¨ÙŠ (VIP)</option></select>
            </div>` : ''}
        </div>
    `).join('');
    
    let total = cart.reduce((sum, item) => sum + parseInt(item.newP), 0);
    document.getElementById('total_price').innerText = total.toLocaleString();
}

function removeFromCart(idx) { cart.splice(idx, 1); renderCart(); }

function submitOrder() {
    const name = document.getElementById('c_name').value;
    const total = document.getElementById('total_price').innerText;
    if(!name || cart.length === 0) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª");

    let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø­Ø¯ÙŠØ«*%0AğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}%0AğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${document.getElementById('c_phone').value}%0AğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø±ÙŠØ§Ù„%0A%0AğŸ“¦ *Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:*%0A`;
    
    cart.forEach(item => {
        msg += `- ${item.name} (${item.newP} Ø±ÙŠØ§Ù„)%0A`;
    });

    window.open(`https://wa.me/9677XXXXXXXX?text=${msg}`);
}
</script>
</body>
</html>
