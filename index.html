<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ù„Ù„Ø®ÙŠØ§Ø·Ø© - Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ 2026</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        :root { --gold: #d4af37; --brown: #5d4037; --bg: #fdfbf7; --white: #ffffff; --dark: #1a1a1a; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); margin: 0; padding: 10px; direction: rtl; }
        
        .main-container { max-width: 600px; margin: auto; background: var(--white); border-radius: 20px; border: 1px solid var(--gold); box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        
        .header { text-align: center; padding: 20px; border-bottom: 2px solid var(--gold); background: #f0f4f8; /* Ù„ÙˆÙ† Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¹Ù„ÙˆÙŠ */ }
        .logo { width: 120px; height: 120px; object-fit: contain; border-radius: 50%; background: white; padding: 5px; border: 2px solid var(--gold); }
        
        .cust-info { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; background: #fff9eb; }
        .cust-info input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; width: 100%; box-sizing: border-box; }

        .main-tabs { display: flex; background: #eee; }
        .tab-btn { flex: 1; padding: 15px; border: none; cursor: pointer; font-weight: bold; background: #eee; color: #666; }
        .tab-btn.active { background: var(--gold); color: white; }

        .items-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 10px; }
        .product-card { border: 1px solid #eee; border-radius: 15px; overflow: hidden; background: white; text-align: center; cursor: pointer; }
        .product-card img { width: 100%; height: 150px; object-fit: cover; }

        /* Ù†Ø§ÙØ°Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© */
        .preview-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:30000; justify-content:center; align-items:center; flex-direction:column; }
        .preview-content { max-width: 90%; max-height: 70%; border-radius: 15px; }

        .qty-controls { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 5px; }
        .qty-btn { background: var(--brown); color: white; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; }

        .selected-item { background: #fff9eb; border: 1px solid var(--gold); border-radius: 12px; padding: 10px; margin-bottom: 10px; position: relative; }
        .remove-btn { position: absolute; top: 5px; left: 5px; background: #ff4d4d; color: white; border: none; border-radius: 50%; width: 22px; height: 22px; cursor: pointer; }

        .btn-send { width: 100%; padding: 18px; background: var(--brown); color: white; border: none; border-radius: 15px; font-size: 18px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        
        .admin-item-card { display: flex; justify-content: space-between; align-items: center; background: #333; padding: 10px; margin-bottom: 5px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="header">
        <img src="https://i.ibb.co/C3YFp0k7/688339f4-1296-48c0-bc66-3be039832675.png" class="logo" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ">
        <h2 style="margin:10px 0 0 0; color:var(--brown);">Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø­Ø¯ÙŠØ« Ù„Ù„Ø®ÙŠØ§Ø·Ø©</h2>
    </div>

    <div class="cust-info">
        <input type="text" id="c_name" placeholder="Ø¥Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
        <input type="tel" id="c_phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    </div>

    <div class="main-tabs">
        <button class="tab-btn active" onclick="switchTab('tailor')">Ø£Ù‚Ù…Ø´Ø© Ø§Ù„ØªÙØµÙŠÙ„</button>
        <button class="tab-btn" onclick="switchTab('ready')">Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©</button>
    </div>

    <div id="tab_tailor" class="section" style="display:block;">
        <div id="fabric_display" class="items-grid"></div>
        <div id="tailor_cart" style="padding:15px;"></div>
    </div>

    <div id="tab_ready" class="section" style="display:none;">
        <div id="ready_display" class="items-grid"></div>
        <div id="ready_cart" style="padding:15px;"></div>
    </div>

    <div style="padding:15px; border-top:2px solid #eee;">
        <h4 style="margin:0 0 10px 0;">ğŸ’³ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ (Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†):</h4>
        <div id="deposit_info" style="margin-bottom:10px; font-size:13px; color:green; font-weight:bold;"></div>
        
        <div style="background:#f4f4f4; padding:10px; border-radius:10px; margin-bottom:5px;">
            <span>Ø¨Ù†Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ: <b>3005374854</b></span>
            <button onclick="copyText('3005374854')" style="float:left; border:none; background:var(--gold); color:white; border-radius:5px; padding:2px 8px; cursor:pointer;">Ù†Ø³Ø®</button>
        </div>
        <div style="background:#f4f4f4; padding:10px; border-radius:10px; margin-bottom:10px;">
            <span>Ù…Ø­ÙØ¸Ø© Ø¬ÙŠØ¨: <b>595720</b></span>
            <button onclick="copyText('595720')" style="float:left; border:none; background:var(--gold); color:white; border-radius:5px; padding:2px 8px; cursor:pointer;">Ù†Ø³Ø®</button>
        </div>
        
        <input type="file" id="receipt_file" accept="image/*" style="width:100%; font-size:12px;">
    </div>

    <div style="background:var(--brown); color:white; padding:20px; text-align:center;">
        <h3 style="margin:0;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="grand_total">0</span> Ø±ÙŠØ§Ù„</h3>
        <button class="btn-send" onclick="sendToWhatsApp()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
</div>

<div id="previewModal" class="preview-modal">
    <img id="previewImg" class="preview-content">
    <h3 id="previewTitle" style="color:white; margin:15px 0 5px 0;"></h3>
    <p id="previewPrice" style="color:var(--gold); font-size:18px; margin:0;"></p>
    <div style="display:flex; gap:10px; margin-top:20px;">
        <button id="addBtn" style="padding:10px 30px; background:var(--gold); color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
        <button onclick="closePreview()" style="padding:10px 30px; background:#444; color:white; border:none; border-radius:10px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="adminPanel" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:40000; overflow-y:auto; padding:20px; box-sizing:border-box;">
    <div style="max-width:500px; margin:auto; background:white; border-radius:15px; padding:20px;">
        <h3>âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
        <div style="background:#eee; padding:10px; border-radius:10px; margin-bottom:20px;">
            <h4>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯:</h4>
            <select id="adm_cat" style="width:100%; padding:10px; margin-bottom:5px;">
                <option value="fabric">Ù‚Ù…Ø§Ø´ ØªÙØµÙŠÙ„</option>
                <option value="ready">Ø¬Ø§Ù‡Ø²</option>
            </select>
            <input type="file" id="adm_file" onchange="encodeImg(this)" style="margin-bottom:5px;">
            <input type="text" id="adm_name" placeholder="Ø§Ù„Ø§Ø³Ù…" style="width:100%; padding:10px; margin-bottom:5px;">
            <input type="number" id="adm_price" placeholder="Ø§Ù„Ø³Ø¹Ø±" style="width:100%; padding:10px; margin-bottom:5px;">
            <button onclick="saveProduct()" style="width:100%; padding:10px; background:green; color:white; border:none; border-radius:5px;">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
        </div>
        <h4>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù„Ù„Ø­Ø°Ù):</h4>
        <div id="admin_list"></div>
        <button onclick="closeAdmin()" style="width:100%; margin-top:20px; padding:10px; border:none; background:#ccc;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<button onclick="openAdmin()" style="position:fixed; bottom:20px; left:20px; background:none; border:none; font-size:24px; cursor:pointer;">âš™ï¸</button>

<script>
// --- ØªÙƒÙˆÙŠÙ† Firebase ---
const firebaseConfig = { databaseURL: "https://alyarmok-store-default-rtdb.firebaseio.com/" };
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let allProducts = [];
let cart = [];
let tempImg = "";

// --- Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
database.ref('products').on('value', (snap) => {
    const data = snap.val();
    allProducts = [];
    if(data) {
        for(let id in data) allProducts.push({...data[id], id});
    }
    renderStore();
    renderAdmin();
});

function renderStore() {
    const fabDiv = document.getElementById('fabric_display');
    const readyDiv = document.getElementById('ready_display');
    fabDiv.innerHTML = ""; readyDiv.innerHTML = "";

    allProducts.forEach(p => {
        const html = `
            <div class="product-card" onclick="openPreview('${p.id}')">
                <img src="${p.img}">
                <div style="padding:8px;">
                    <div style="font-weight:bold; font-size:14px;">${p.name}</div>
                    <div style="color:green; font-size:13px;">${p.price} Ø±ÙŠØ§Ù„</div>
                </div>
            </div>`;
        if(p.cat === 'fabric') fabDiv.innerHTML += html;
        else readyDiv.innerHTML += html;
    });
}

// --- Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ© ---
function openPreview(id) {
    const p = allProducts.find(x => x.id === id);
    document.getElementById('previewImg').src = p.img;
    document.getElementById('previewTitle').innerText = p.name;
    document.getElementById('previewPrice').innerText = p.price + " Ø±ÙŠØ§Ù„";
    document.getElementById('addBtn').onclick = () => { addToCart(p); closePreview(); };
    document.getElementById('previewModal').style.display = 'flex';
}

function closePreview() { document.getElementById('previewModal').style.display = 'none'; }

function addToCart(p) {
    const exist = cart.find(item => item.id === p.id);
    if(exist) exist.qty++;
    else cart.push({...p, qty: 1});
    renderCart();
}

function renderCart() {
    const tailorCart = document.getElementById('tailor_cart');
    const readyCart = document.getElementById('ready_cart');
    tailorCart.innerHTML = "<h4>Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</h4>";
    readyCart.innerHTML = "<h4>Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</h4>";
    
    let total = 0;
    cart.forEach((item, index) => {
        total += (item.price * item.qty);
        const html = `
            <div class="selected-item">
                <button class="remove-btn" onclick="removeFromCart(${index})">Ã—</button>
                <div style="font-size:13px; font-weight:bold;">${item.name}</div>
                <div class="qty-controls">
                    <button class="qty-btn" onclick="updateQty(${index}, -1)">-</button>
                    <span>${item.qty}</span>
                    <button class="qty-btn" onclick="updateQty(${index}, 1)">+</button>
                    <span style="margin-right:auto; color:green;">${item.price * item.qty} Ø±ÙŠØ§Ù„</span>
                </div>
            </div>`;
        if(item.cat === 'fabric') tailorCart.innerHTML += html;
        else readyCart.innerHTML += html;
    });
    
    document.getElementById('grand_total').innerText = total.toLocaleString();
    updateDeposit(total);
}

function updateQty(index, change) {
    cart[index].qty += change;
    if(cart[index].qty < 1) cart.splice(index, 1);
    renderCart();
}

function removeFromCart(index) {
    cart.splice(index, 1);
    renderCart();
}

function updateDeposit(total) {
    const depositInfo = document.getElementById('deposit_info');
    if(total === 0) { depositInfo.style.display = 'none'; return; }
    
    let deposit = 0;
    if(total >= 50000) deposit = total * 0.20;
    else deposit = total * 0.50;
    
    depositInfo.style.display = 'block';
    depositInfo.innerText = `Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¢Ù†: ${deposit.toLocaleString()} Ø±ÙŠØ§Ù„`;
}

// --- ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© ---
function switchTab(t) {
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab_' + t).style.display = 'block';
    event.currentTarget.classList.add('active');
}

function copyText(txt) {
    navigator.clipboard.writeText(txt);
    alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…: " + txt);
}

function sendToWhatsApp() {
    const name = document.getElementById('c_name').value;
    const total = document.getElementById('grand_total').innerText;
    if(!name || cart.length === 0) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬Ø§Øª");

    let details = "ğŸ“¦ *ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:*%0A";
    cart.forEach(item => {
        details += `- ${item.name} | Ø§Ù„Ø¹Ø¯Ø¯: ${item.qty} | Ø§Ù„Ø³Ø¹Ø±: ${item.price * item.qty}%0A`;
    });

    const msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ Ø§Ù„Ø­Ø¯ÙŠØ«*%0AğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}%0A${details}%0AğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø±ÙŠØ§Ù„%0Aâœ… ØªÙ… Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ø¥ÙŠØµØ§Ù„ ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.`;
    window.open(`https://wa.me/9677XXXXXXXX?text=${msg}`);
}

// --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ---
function openAdmin() { if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:") === "1234") document.getElementById('adminPanel').style.display = 'block'; }
function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; }

function encodeImg(i) {
    const r = new FileReader();
    r.onload = (e) => tempImg = e.target.result;
    r.readAsDataURL(i.files[0]);
}

function saveProduct() {
    const cat = document.getElementById('adm_cat').value;
    const name = document.getElementById('adm_name').value;
    const price = document.getElementById('adm_price').value;
    if(!tempImg || !name || !price) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    
    database.ref('products').push({cat, name, price: parseInt(price), img: tempImg})
    .then(() => { alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); tempImg = ""; document.getElementById('adm_file').value = ""; });
}

function deleteProduct(id) {
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) database.ref('products/' + id).remove();
}

function renderAdmin() {
    const list = document.getElementById('admin_list');
    list.innerHTML = allProducts.map(p => `
        <div class="admin-item-card">
            <span>${p.name} (${p.cat === 'fabric' ? 'Ù‚Ù…Ø§Ø´' : 'Ø¬Ø§Ù‡Ø²'})</span>
            <button onclick="deleteProduct('${p.id}')" style="background:red; color:white; border:none; padding:5px 10px; border-radius:5px;">Ø­Ø°Ù</button>
        </div>
    `).join('');
}
</script>
</body>
</html>
